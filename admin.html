<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CSMR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&family=Source+Sans+Pro:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/recharts@2.8.0/dist/Recharts.js"></script>
    <style>
        body {
            font-family: 'Source Sans Pro', sans-serif;
        }
        h1, h2, h3, h4, h5, h6, .hero-title {
            font-family: 'Merriweather', serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1e40af 100%);
        }
        .sidebar {
            transition: all 0.3s ease;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .sidebar.collapsed .sidebar-text {
            display: none;
        }
        .main-content {
            transition: all 0.3s ease;
        }
        .main-content.expanded {
            margin-left: 80px;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
    <script>
        // IMMEDIATE AUTHENTICATION CHECK - Run before page loads
        (function() {
            const adminToken = localStorage.getItem('adminToken');
            if (!adminToken || adminToken !== 'admin-token-123') {
                window.location.href = 'admin-login.html';
            }
        })();
    </script>
</head>
<body class="bg-gray-50">
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-white shadow-lg z-30">
        <!-- Logo -->
        <div class="p-6 border-b border-gray-200">
            <div class="flex items-center space-x-3">
                <div class="text-2xl font-black text-blue-900">CSMR</div>
                <div class="w-0.5 h-6 bg-blue-400"></div>
                <div class="text-blue-600 font-medium sidebar-text">
                    <div class="text-xs leading-tight">Admin Panel</div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="mt-6">
            <div class="px-4 space-y-2">
                <a href="#" onclick="showPage('dashboard')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-tachometer-alt w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Dashboard</span>
                </a>
                <a href="#" onclick="showPage('submissions')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-file-alt w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">New Submissions</span>
                    <span class="sidebar-text ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full">12</span>
                </a>
                <a href="#" onclick="showPage('editors')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-user-tie w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Assign Editors</span>
                </a>
                <a href="#" onclick="showPage('reviewers')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-user-graduate w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Assign Reviewers</span>
                </a>
                <a href="#" onclick="showPage('reviewer-desk')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-clipboard-list w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Reviewer Desk</span>
                </a>
                <a href="#" onclick="showPage('decisions')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-check-circle w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Decisions</span>
                </a>
                <a href="#" onclick="showPage('analytics')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-chart-bar w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Analytics & Reports</span>
                </a>
                <a href="#" onclick="showPage('settings')" class="nav-item flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-colors">
                    <i class="fas fa-cog w-5"></i>
                    <span class="sidebar-text ml-3 font-medium">Settings</span>
                </a>
            </div>
        </nav>

        <!-- Collapse Button -->
        <div class="absolute bottom-4 left-4">
            <button onclick="toggleSidebar()" class="p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content ml-64 min-h-screen">
        <!-- Top Navigation -->
        <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 id="pageTitle" class="text-2xl font-bold text-gray-900">Dashboard</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <div class="relative">
                        <input type="text" placeholder="Search..." class="w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    
                    <!-- Notifications -->
                    <button class="relative p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg">
                        <i class="fas fa-bell"></i>
                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                    </button>
                    
                    <!-- Admin Profile Dropdown -->
                    <div class="relative">
                        <button onclick="toggleProfileDropdown()" class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold">
                                A
                            </div>
                            <div class="text-left">
                                <div class="text-sm font-medium text-gray-900">Admin User</div>
                                <div class="text-xs text-gray-500">admin123@gmail.com</div>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400"></i>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-user mr-2"></i>Profile
                            </a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                                <i class="fas fa-cog mr-2"></i>Settings
                            </a>
                            <hr class="my-2">
                            <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">
                                <i class="fas fa-sign-out-alt mr-2"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <div class="p-6">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page active">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="card-hover bg-white p-6 rounded-xl shadow-lg border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">New Submissions</p>
                                <p class="text-3xl font-bold text-blue-600">12</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-alt text-2xl text-blue-600"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">+3 from last week</p>
                    </div>

                    <div class="card-hover bg-white p-6 rounded-xl shadow-lg border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Under Review</p>
                                <p class="text-3xl font-bold text-blue-600">28</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-search text-2xl text-blue-600"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">+5 from last week</p>
                    </div>

                    <div class="card-hover bg-white p-6 rounded-xl shadow-lg border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Accepted</p>
                                <p class="text-3xl font-bold text-blue-600">45</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-2xl text-blue-600"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">+8 from last week</p>
                    </div>

                    <div class="card-hover bg-white p-6 rounded-xl shadow-lg border border-blue-100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Rejected</p>
                                <p class="text-3xl font-bold text-blue-600">18</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-times-circle text-2xl text-blue-600"></i>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">+2 from last week</p>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Submissions</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">Sustainable Supply Chain Management</p>
                                    <p class="text-sm text-gray-500">Dr. Rajesh Kumar • 2 hours ago</p>
                                </div>
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">New</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">ESG Reporting Impact Analysis</p>
                                    <p class="text-sm text-gray-500">Dr. Priya Sharma • 4 hours ago</p>
                                </div>
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">Under Review</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-900">Climate Change Adaptation Strategies</p>
                                    <p class="text-sm text-gray-500">Dr. Vikram Singh • 6 hours ago</p>
                                </div>
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">Accepted</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="showPage('submissions')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg text-center transition-colors">
                                <i class="fas fa-file-alt text-2xl text-blue-600 mb-2"></i>
                                <p class="text-sm font-medium text-blue-900">Review Submissions</p>
                            </button>
                            <button onclick="showPage('editors')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg text-center transition-colors">
                                <i class="fas fa-user-tie text-2xl text-blue-600 mb-2"></i>
                                <p class="text-sm font-medium text-blue-900">Assign Editors</p>
                            </button>
                            <button onclick="showPage('reviewers')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg text-center transition-colors">
                                <i class="fas fa-user-graduate text-2xl text-blue-600 mb-2"></i>
                                <p class="text-sm font-medium text-blue-900">Assign Reviewers</p>
                            </button>
                            <button onclick="showPage('analytics')" class="p-4 bg-blue-50 hover:bg-blue-100 rounded-lg text-center transition-colors">
                                <i class="fas fa-chart-bar text-2xl text-blue-600 mb-2"></i>
                                <p class="text-sm font-medium text-blue-900">View Analytics</p>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Submissions Page -->
            <div id="submissions" class="page">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">New Submissions</h3>
                        <p class="text-sm text-gray-500">Manage and review new paper submissions</p>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Author(s)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="submissionsTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Submissions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Assign Editors Page -->
            <div id="editors" class="page">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Assign Editors</h3>
                        <div class="flex space-x-4">
                            <button onclick="showAddEditorModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Add Editor
                            </button>
                            <div class="relative">
                                <input type="text" id="editorSearch" placeholder="Search editors..." class="w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Manuscript Selection -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Manuscript to Assign Editor:</label>
                        <select id="editorManuscriptSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select a manuscript...</option>
                            <option value="MS-2024-001" 
                                    data-title="Sustainable Supply Chain Management in Indian Manufacturing"
                                    data-authors="Dr. Rajesh Kumar, Dr. Priya Sharma"
                                    data-abstract="This study examines sustainable supply chain practices in Indian manufacturing industries, analyzing the impact of green initiatives on operational efficiency and environmental performance. The research employs a mixed-methods approach, combining quantitative data from 150 manufacturing firms with qualitative insights from industry experts.">
                                Sustainable Supply Chain Management in Indian Manufacturing
                            </option>
                            <option value="MS-2024-002" 
                                    data-title="ESG Reporting Impact on Financial Performance"
                                    data-authors="Dr. Vikram Singh, Dr. Anita Desai"
                                    data-abstract="An analysis of how ESG reporting affects financial performance in publicly traded companies. This comprehensive study examines the correlation between environmental, social, and governance disclosures and stock market returns, using data from 500 companies over a 10-year period.">
                                ESG Reporting Impact on Financial Performance
                            </option>
                            <option value="MS-2024-003" 
                                    data-title="Climate Change Adaptation Strategies for Business"
                                    data-authors="Dr. Meena Patel, Dr. Rahul Verma"
                                    data-abstract="A comprehensive study on business adaptation strategies for climate change impacts. This research explores how organizations across different sectors are preparing for and responding to climate-related risks, with a focus on resilience planning and sustainable business models.">
                                Climate Change Adaptation Strategies for Business
                            </option>
                        </select>
                    </div>

                    <div id="editorsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Editors will be loaded here -->
                    </div>

                    <div id="noEditors" class="text-center py-8 text-gray-500 hidden">
                        <i class="fas fa-user-tie text-4xl mb-4"></i>
                        <p>No editors found. Try adjusting your search or add a new editor.</p>
                    </div>
                </div>
            </div>

            <!-- Assign Reviewers Page -->
            <div id="reviewers" class="page">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Assign Reviewers</h3>
                        <div class="flex space-x-4">
                            <button onclick="showAddReviewerModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Add Reviewer
                            </button>
                        <div class="relative">
                                <input type="text" id="reviewerSearch" placeholder="Search reviewers..." class="w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Manuscript Selection -->
                    <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Manuscript to Review:</label>
                        <select id="manuscriptSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select a manuscript...</option>
                            <option value="MS-2024-001" 
                                    data-title="Sustainable Supply Chain Management in Indian Manufacturing"
                                    data-authors="Dr. Rajesh Kumar, Dr. Priya Sharma"
                                    data-abstract="This study examines sustainable supply chain practices in Indian manufacturing industries, analyzing the impact of green initiatives on operational efficiency and environmental performance. The research employs a mixed-methods approach, combining quantitative data from 150 manufacturing firms with qualitative insights from industry experts.">
                                Sustainable Supply Chain Management in Indian Manufacturing
                            </option>
                            <option value="MS-2024-002" 
                                    data-title="ESG Reporting Impact on Financial Performance"
                                    data-authors="Dr. Vikram Singh, Dr. Anita Desai"
                                    data-abstract="An analysis of how ESG reporting affects financial performance in publicly traded companies. This comprehensive study examines the correlation between environmental, social, and governance disclosures and stock market returns, using data from 500 companies over a 10-year period.">
                                ESG Reporting Impact on Financial Performance
                            </option>
                            <option value="MS-2024-003" 
                                    data-title="Climate Change Adaptation Strategies for Business"
                                    data-authors="Dr. Meena Patel, Dr. Rahul Verma"
                                    data-abstract="A comprehensive study on business adaptation strategies for climate change impacts. This research explores how organizations across different sectors are preparing for and responding to climate-related risks, with a focus on resilience planning and sustainable business models.">
                                Climate Change Adaptation Strategies for Business
                            </option>
                        </select>
                        </div>

                    <div id="reviewersList" class="space-y-4">
                        <!-- Reviewers will be loaded here -->
                        </div>

                    <div id="noReviewers" class="text-center py-8 text-gray-500 hidden">
                        <i class="fas fa-user-graduate text-4xl mb-4"></i>
                        <p>No reviewers found. Try adjusting your search.</p>
                    </div>
                </div>
            </div>

            <!-- Reviewer Desk Page -->
            <div id="reviewer-desk" class="page">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-clipboard-list text-2xl text-blue-600"></i>
                            <h3 class="text-lg font-semibold text-gray-900">Reviewer Desk</h3>
                        </div>
                        <div class="flex space-x-4">
                            <select id="statusFilter" onchange="filterReviews()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">All Reviews</option>
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                            <button onclick="refreshReviews()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-sync-alt mr-2"></i>Refresh
                            </button>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="reviewSearch" placeholder="Search by manuscript title, reviewer name, or ID..." 
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Reviews Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 font-medium text-gray-900">Manuscript ID</th>
                                    <th class="px-4 py-3 font-medium text-gray-900">Title</th>
                                    <th class="px-4 py-3 font-medium text-gray-900">Reviewer</th>
                                    <th class="px-4 py-3 font-medium text-gray-900">Assigned Date</th>
                                    <th class="px-4 py-3 font-medium text-gray-900">Due Date</th>
                                    <th class="px-4 py-3 font-medium text-gray-900">Status</th>
                                    <th class="px-4 py-3 font-medium text-gray-900">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reviewsTableBody">
                                <!-- Reviews will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- No Reviews Message -->
                    <div id="noReviews" class="text-center py-8 text-gray-500 hidden">
                        <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                        <p>No reviews found. Assign reviewers to see them here.</p>
                    </div>
                </div>
            </div>

            <!-- Decisions Page -->
            <div id="decisions" class="page">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">Editorial Decisions</h3>
                    
                    <div class="space-y-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">Sustainable Supply Chain Management in Indian Manufacturing</h4>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">Reviews Complete</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Dr. Rajesh Kumar, Dr. Priya Sharma • Submitted: 2025-01-15</p>
                            <div class="flex space-x-3">
                                <button class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                    Accept
                                </button>
                                <button class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                                    Minor Revision
                                </button>
                                <button class="bg-blue-400 text-white py-2 px-4 rounded-lg hover:bg-blue-500 transition-colors">
                                    Major Revision
                                </button>
                                <button class="bg-blue-700 text-white py-2 px-4 rounded-lg hover:bg-blue-800 transition-colors">
                                    Reject
                                </button>
                            </div>
                        </div>

                        <div class="border border-gray-200 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">ESG Reporting Impact on Financial Performance</h4>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">Reviews Complete</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-3">Dr. Vikram Singh, Dr. Anita Desai • Submitted: 2025-01-14</p>
                            <div class="flex space-x-3">
                                <button class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                    Accept
                                </button>
                                <button class="bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                                    Minor Revision
                                </button>
                                <button class="bg-blue-400 text-white py-2 px-4 rounded-lg hover:bg-blue-500 transition-colors">
                                    Major Revision
                                </button>
                                <button class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                                    Reject
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics" class="page">
                <div class="space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Submissions per Month</h3>
                            <div id="submissionsChart" class="h-64"></div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Acceptance Rate</h3>
                            <div id="acceptanceChart" class="h-64"></div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Average Review Time</h3>
                        <div id="reviewTimeChart" class="h-64"></div>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div id="settings" class="page">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">System Settings</h3>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Journal Name</label>
                            <input type="text" value="CSMR - Centre for Sustainability & Management Research" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Review Deadline (days)</label>
                            <input type="number" value="30" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Notifications</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">New submissions</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" checked class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Review completions</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Weekly reports</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="flex justify-end">
                            <button class="bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                                Save Settings
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Editor Modal -->
    <div id="addEditorModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Add New Editor</h3>
                </div>
                
                <form id="addEditorForm" class="p-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                            <input type="text" id="editorFirstName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                            <input type="text" id="editorLastName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="editorEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Expertise (comma-separated)</label>
                            <input type="text" id="editorExpertise" placeholder="e.g., Sustainability, Management, ESG" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="hideAddEditorModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Add Editor
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Reviewer Modal -->
    <div id="addReviewerModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Add New Reviewer</h3>
                </div>
                
                <form id="addReviewerForm" class="p-6">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                            <input type="text" id="reviewerFirstName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                            <input type="text" id="reviewerLastName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" id="reviewerEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Expertise (comma-separated)</label>
                            <input type="text" id="reviewerExpertise" placeholder="e.g., Sustainability, Management, ESG" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" onclick="hideAddReviewerModal()" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Add Reviewer
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Review Window Modal -->
    <div id="reviewWindowModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900">Review Window</h3>
                    <button onclick="closeReviewWindow()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="p-6">
                    <!-- Manuscript Details -->
                    <div class="mb-6">
                        <h4 class="text-md font-semibold text-gray-900 mb-3">Manuscript Details</h4>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Manuscript ID:</p>
                                    <p class="font-medium" id="modalManuscriptId">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Title:</p>
                                    <p class="font-medium" id="modalManuscriptTitle">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Authors:</p>
                                    <p class="font-medium" id="modalManuscriptAuthors">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Abstract:</p>
                                    <p class="font-medium" id="modalManuscriptAbstract">-</p>
                                </div>
                            </div>
                            <div class="mt-4 flex space-x-4">
                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>View PDF
                                </button>
                                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-file-alt mr-2"></i>View HTML
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Review Form -->
                    <div class="mb-6">
                        <h4 class="text-md font-semibold text-gray-900 mb-3">Review Form</h4>
                        <form id="reviewForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Comments to Author</label>
                                <textarea id="commentsToAuthor" rows="4" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="Provide constructive feedback for the authors..."></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Comments to Editor</label>
                                <textarea id="commentsToEditor" rows="4" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="Confidential comments for the editorial team..."></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Recommendation</label>
                                <select id="recommendation" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Select recommendation...</option>
                                    <option value="accept">Accept</option>
                                    <option value="minor">Minor Revision</option>
                                    <option value="major">Major Revision</option>
                                    <option value="reject">Reject</option>
                                </select>
                            </div>
                        </form>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-4">
                        <button onclick="closeReviewWindow()" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button onclick="saveReviewDraft()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-save mr-2"></i>Save Draft
                        </button>
                        <button onclick="submitReview()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-check mr-2"></i>Submit Review
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Review Modal -->
    <div id="viewReviewModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-900">Submitted Review</h3>
                    <button onclick="closeViewReviewModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="p-6">
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600">Comments to Author:</p>
                            <p class="font-medium" id="viewCommentsToAuthor">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Comments to Editor:</p>
                            <p class="font-medium" id="viewCommentsToEditor">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Recommendation:</p>
                            <p class="font-medium" id="viewRecommendation">-</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Submitted Date:</p>
                            <p class="font-medium" id="viewSubmittedDate">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check admin authentication
        function checkAdminAuth() {
            const adminToken = localStorage.getItem('adminToken');
            if (!adminToken || adminToken !== 'admin-token-123') {
                window.location.href = 'admin-login.html';
                return;
            }
        }
        
        // Check again on page load (redundant but safe)
        checkAdminAuth();

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'submissions': 'New Submissions',
                'editors': 'Assign Editors',
                'reviewers': 'Assign Reviewers',
                'reviewer-desk': 'Reviewer Desk',
                'decisions': 'Editorial Decisions',
                'analytics': 'Analytics & Reports',
                'settings': 'Settings'
            };
            document.getElementById('pageTitle').textContent = titles[pageId];
            
            // Load data for specific pages
            if (pageId === 'submissions') {
                loadSubmissions();
            }
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-600');
                item.classList.add('text-gray-700');
            });
            
            event.target.closest('.nav-item').classList.add('bg-blue-50', 'text-blue-600');
            event.target.closest('.nav-item').classList.remove('text-gray-700');
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        // Toggle profile dropdown
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('hidden');
        }

        // Logout function
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            window.location.href = 'admin-login.html';
        }

        // Initialize charts (simplified for demo)
        function initCharts() {
            // This would normally use Recharts or Chart.js
            // For now, we'll just show placeholder content
            document.getElementById('submissionsChart').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Chart will be rendered here</div>';
            document.getElementById('acceptanceChart').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Chart will be rendered here</div>';
            document.getElementById('reviewTimeChart').innerHTML = '<div class="flex items-center justify-center h-full text-gray-500">Chart will be rendered here</div>';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profileDropdown');
            const button = event.target.closest('button');
            
            if (!button || !button.onclick || button.onclick.toString().indexOf('toggleProfileDropdown') === -1) {
                dropdown.classList.add('hidden');
            }
        });

        // Load reviewers
        async function loadReviewers(searchTerm = '') {
            try {
                console.log('Loading reviewers with search term:', searchTerm);
                const response = await fetch(`/api/reviewers?search=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                console.log('Reviewers data:', data);
                
                const reviewersList = document.getElementById('reviewersList');
                const noReviewers = document.getElementById('noReviewers');
                
                console.log('Reviewers list element:', reviewersList);
                
                if (data.success && data.reviewers.length > 0) {
                    reviewersList.innerHTML = data.reviewers.map(reviewer => `
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <h4 class="font-medium text-gray-900">Dr. ${reviewer.first_name} ${reviewer.last_name}</h4>
                                    <p class="text-sm text-gray-600">${reviewer.email}</p>
                                    ${reviewer.expertise ? `
                                        <div class="flex flex-wrap gap-2 mt-2">
                                            ${reviewer.expertise.split(',').map(skill => 
                                                `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${skill.trim()}</span>`
                                            ).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="flex flex-col gap-2 ml-4">
                                    <button onclick="inviteReviewer(${reviewer.id})" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        Invite
                                    </button>
                                    <button onclick="removeReviewer(${reviewer.id}, '${reviewer.first_name} ${reviewer.last_name}')" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                        <i class="fas fa-trash mr-1"></i>Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    noReviewers.classList.add('hidden');
                } else {
                    reviewersList.innerHTML = '';
                    noReviewers.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading reviewers:', error);
                alert('Failed to load reviewers');
            }
        }

        // Invite reviewer
        async function inviteReviewer(reviewerId) {
            console.log('Invite reviewer called with ID:', reviewerId);
            const manuscriptSelect = document.getElementById('manuscriptSelect');
            const selectedOption = manuscriptSelect.options[manuscriptSelect.selectedIndex];
            
            console.log('Selected manuscript:', selectedOption.value);
            
            if (!selectedOption.value) {
                alert('Please select a manuscript first');
                return;
            }
            
            const manuscriptId = selectedOption.value;
            const manuscriptTitle = selectedOption.dataset.title;
            const authors = selectedOption.dataset.authors || '';
            const abstract = selectedOption.dataset.abstract || '';
            const dueDate = new Date();
            dueDate.setDate(dueDate.getDate() + 14); // 14 days from now (matching academic journal standards)
            
            try {
                console.log('Sending invitation request:', {
                    reviewerId,
                    manuscriptId,
                    manuscriptTitle
                });
                
                const response = await fetch('/api/reviewers/invite', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        reviewerId,
                        manuscriptId,
                        manuscriptTitle,
                        dueDate: dueDate.toISOString().split('T')[0],
                        authors: authors,
                        abstract: abstract
                    })
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Response error:', errorText);
                    throw new Error(`Server error: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    alert('Review invitation sent successfully! The reviewer will receive a professional email invitation.');
                } else {
                    alert('Failed to send invitation: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error sending invitation:', error);
                alert('Failed to send invitation: ' + error.message);
            }
        }

        // Remove reviewer
        async function removeReviewer(reviewerId, reviewerName) {
            if (!confirm(`Are you sure you want to remove ${reviewerName}?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/reviewers/${reviewerId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Reviewer removed successfully!');
                    loadReviewers(); // Refresh the list
                } else {
                    alert('Failed to remove reviewer: ' + data.message);
                }
            } catch (error) {
                console.error('Error removing reviewer:', error);
                alert('Failed to remove reviewer');
            }
        }

        // Search reviewers
        function setupReviewerSearch() {
            const searchInput = document.getElementById('reviewerSearch');
            let searchTimeout;
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    loadReviewers(e.target.value);
                }, 300);
            });
        }

        // Show add reviewer modal
        function showAddReviewerModal() {
            document.getElementById('addReviewerModal').classList.remove('hidden');
        }

        // Hide add reviewer modal
        function hideAddReviewerModal() {
            document.getElementById('addReviewerModal').classList.add('hidden');
            document.getElementById('addReviewerForm').reset();
        }

        // Add reviewer function
        async function addReviewer(reviewerData) {
            try {
                const response = await fetch('/api/reviewers/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(reviewerData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Reviewer invitation sent successfully! The reviewer will receive an email to approve their account. They will appear in the list once they approve.');
                    hideAddReviewerModal();
                    loadReviewers(); // Refresh the list
                } else {
                    alert('Failed to add reviewer: ' + data.message);
                }
            } catch (error) {
                console.error('Error adding reviewer:', error);
                alert('Failed to add reviewer');
            }
        }

        // Setup add reviewer form
        function setupAddReviewerForm() {
            const form = document.getElementById('addReviewerForm');
            if (form) {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const reviewerData = {
                        firstName: document.getElementById('reviewerFirstName').value,
                        lastName: document.getElementById('reviewerLastName').value,
                        email: document.getElementById('reviewerEmail').value,
                        expertise: document.getElementById('reviewerExpertise').value,
                        password: 'temp_password_123' // Temporary password, reviewer can reset
                    };
                    
                    await addReviewer(reviewerData);
                });
            }
        }

        // Load submissions
        async function loadSubmissions() {
            try {
                const response = await fetch('/api/submissions');
                const data = await response.json();
                
                const tbody = document.getElementById('submissionsTableBody');
                const badgeCount = document.querySelector('a[onclick="showPage(\'submissions\')"] .bg-red-500');
                
                if (data.success && data.submissions.length > 0) {
                    // Update badge count
                    const newSubmissions = data.submissions.filter(s => s.status === 'submitted').length;
                    if (badgeCount) {
                        badgeCount.textContent = newSubmissions;
                        if (newSubmissions === 0) {
                            badgeCount.style.display = 'none';
                        } else {
                            badgeCount.style.display = 'inline-block';
                        }
                    }
                    
                    tbody.innerHTML = data.submissions.map(sub => {
                        const submittedDate = new Date(sub.submitted_date).toLocaleDateString();
                        const statusClass = getSubmissionStatusClass(sub.status);
                        const statusText = getSubmissionStatusText(sub.status);
                        
                        return `
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4">
                                    <div class="text-sm font-medium text-gray-900">${sub.title}</div>
                                    <div class="text-xs text-gray-500 mt-1">ID: ${sub.manuscript_id}</div>
                                </td>
                                <td class="px-6 py-4">
                                    <div class="text-sm text-gray-900">${sub.authors}</div>
                                    ${sub.author_email ? `<div class="text-xs text-gray-500">${sub.author_email}</div>` : ''}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900">${submittedDate}</div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">${statusText}</span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    ${sub.status === 'submitted' ? `
                                        <button onclick="assignEditorToSubmission(${sub.id})" class="text-blue-600 hover:text-blue-900 mr-3">Assign Editor</button>
                                        <button onclick="deskRejectSubmission(${sub.id})" class="text-red-600 hover:text-red-800">Desk Reject</button>
                                    ` : `
                                        <button onclick="viewSubmissionDetails(${sub.id})" class="text-blue-600 hover:text-blue-900 mr-3">View Details</button>
                                        ${sub.status === 'accepted' ? `
                                            <button onclick="publishSubmission(${sub.id})" class="text-blue-600 hover:text-blue-800">Publish</button>
                                        ` : ''}
                                    `}
                                </td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                                <i class="fas fa-file-alt text-4xl mb-4"></i>
                                <p>No submissions found</p>
                            </td>
                        </tr>
                    `;
                    if (badgeCount) {
                        badgeCount.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error loading submissions:', error);
                document.getElementById('submissionsTableBody').innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-red-500">
                            Error loading submissions. Please try again.
                        </td>
                    </tr>
                `;
            }
        }

        function getSubmissionStatusClass(status) {
            const statusMap = {
                'submitted': 'bg-blue-100 text-blue-800',
                'under-review': 'bg-blue-100 text-blue-800',
                'in-review': 'bg-blue-100 text-blue-800',
                'accepted': 'bg-blue-100 text-blue-800',
                'rejected': 'bg-blue-100 text-blue-800',
                'revision': 'bg-blue-100 text-blue-800',
                'revision-required': 'bg-blue-100 text-blue-800'
            };
            return statusMap[status] || 'bg-gray-100 text-gray-800';
        }

        function getSubmissionStatusText(status) {
            const statusMap = {
                'submitted': 'New',
                'under-review': 'Under Review',
                'in-review': 'Under Review',
                'accepted': 'Accepted',
                'rejected': 'Rejected',
                'revision': 'Revision Required',
                'revision-required': 'Revision Required'
            };
            return statusMap[status] || 'Submitted';
        }

        // Placeholder functions for submission actions
        function assignEditorToSubmission(submissionId) {
            alert('Assign Editor functionality - Coming soon!');
        }

        function deskRejectSubmission(submissionId) {
            if (confirm('Are you sure you want to desk reject this submission?')) {
                // Update submission status to rejected
                fetch(`/api/submissions/${submissionId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'rejected',
                        decision: 'rejected',
                        notes: 'Desk rejected by admin'
                    })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Submission rejected successfully');
                        loadSubmissions();
                    } else {
                        alert('Failed to reject submission: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error rejecting submission');
                });
            }
        }

        function viewSubmissionDetails(submissionId) {
            alert('View Details functionality - Coming soon!');
        }

        function publishSubmission(submissionId) {
            alert('Publish functionality - Coming soon!');
        }

        // Reviewer Desk Functions
        let currentReviews = [];
        let currentReviewId = null;

        // Load reviews
        async function loadReviews() {
            try {
                console.log('Loading reviews...');
                const response = await fetch('/api/reviews');
                const data = await response.json();
                
                if (data.success) {
                    currentReviews = data.reviews;
                    displayReviews(data.reviews);
                } else {
                    console.error('Failed to load reviews:', data.message);
                    displayReviews([]);
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
                displayReviews([]);
            }
        }

        // Display reviews in table
        function displayReviews(reviews) {
            const tbody = document.getElementById('reviewsTableBody');
            const noReviews = document.getElementById('noReviews');
            
            if (reviews.length === 0) {
                tbody.innerHTML = '';
                noReviews.classList.remove('hidden');
                return;
            }
            
            noReviews.classList.add('hidden');
            tbody.innerHTML = reviews.map(review => `
                <tr class="border-b border-gray-200 hover:bg-gray-50">
                    <td class="px-4 py-3 font-mono text-sm">${review.manuscript_id}</td>
                    <td class="px-4 py-3">
                        <div class="max-w-xs truncate" title="${review.manuscript_title}">
                            ${review.manuscript_title}
                        </div>
                    </td>
                    <td class="px-4 py-3">Dr. ${review.reviewer_name}</td>
                    <td class="px-4 py-3">${new Date(review.assigned_date).toLocaleDateString()}</td>
                    <td class="px-4 py-3">${new Date(review.due_date).toLocaleDateString()}</td>
                    <td class="px-4 py-3">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${getStatusClass(review.status)}">
                            ${review.status}
                        </span>
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex space-x-2">
                            <button onclick="openReviewWindow(${review.id})" 
                                class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 transition-colors">
                                Open Review
                            </button>
                            ${review.status === 'completed' ? 
                                `<button onclick="viewReview(${review.id})" 
                                    class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700 transition-colors">
                                    View Review
                                </button>` : 
                                `<button onclick="remindReviewer(${review.id})" 
                                    class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                    Remind
                                </button>`
                            }
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Get status CSS class
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'bg-blue-100 text-blue-800';
                case 'in-progress': return 'bg-blue-100 text-blue-800';
                case 'completed': return 'bg-blue-100 text-blue-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Filter reviews by status
        function filterReviews() {
            const filter = document.getElementById('statusFilter').value;
            let filteredReviews = currentReviews;
            
            if (filter !== 'all') {
                filteredReviews = currentReviews.filter(review => review.status === filter);
            }
            
            displayReviews(filteredReviews);
        }

        // Refresh reviews
        function refreshReviews() {
            loadReviews();
        }

        // Open review window
        function openReviewWindow(reviewId) {
            const review = currentReviews.find(r => r.id === reviewId);
            if (!review) return;
            
            currentReviewId = reviewId;
            
            // Populate modal with review data
            document.getElementById('modalManuscriptId').textContent = review.manuscript_id;
            document.getElementById('modalManuscriptTitle').textContent = review.manuscript_title;
            document.getElementById('modalManuscriptAuthors').textContent = review.authors || 'Not specified';
            document.getElementById('modalManuscriptAbstract').textContent = review.abstract || 'Not available';
            
            // Clear form
            document.getElementById('commentsToAuthor').value = review.comments_to_author || '';
            document.getElementById('commentsToEditor').value = review.comments_to_editor || '';
            document.getElementById('recommendation').value = review.recommendation || '';
            
            document.getElementById('reviewWindowModal').classList.remove('hidden');
        }

        // Close review window
        function closeReviewWindow() {
            document.getElementById('reviewWindowModal').classList.add('hidden');
            currentReviewId = null;
        }

        // Save review draft
        async function saveReviewDraft() {
            if (!currentReviewId) return;
            
            const reviewData = {
                comments_to_author: document.getElementById('commentsToAuthor').value,
                comments_to_editor: document.getElementById('commentsToEditor').value,
                recommendation: document.getElementById('recommendation').value,
                status: 'in-progress'
            };
            
            try {
                const response = await fetch(`/api/reviews/${currentReviewId}/draft`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(reviewData)
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Draft saved successfully!');
                    loadReviews(); // Refresh the list
                } else {
                    alert('Failed to save draft: ' + data.message);
                }
            } catch (error) {
                console.error('Error saving draft:', error);
                alert('Failed to save draft');
            }
        }

        // Submit review
        async function submitReview() {
            if (!currentReviewId) return;
            
            const reviewData = {
                comments_to_author: document.getElementById('commentsToAuthor').value,
                comments_to_editor: document.getElementById('commentsToEditor').value,
                recommendation: document.getElementById('recommendation').value,
                status: 'completed'
            };
            
            if (!reviewData.recommendation) {
                alert('Please select a recommendation before submitting.');
                return;
            }
            
            try {
                const response = await fetch(`/api/reviews/${currentReviewId}/submit`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(reviewData)
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('Review submitted successfully!');
                    closeReviewWindow();
                    loadReviews(); // Refresh the list
                } else {
                    alert('Failed to submit review: ' + data.message);
                }
            } catch (error) {
                console.error('Error submitting review:', error);
                alert('Failed to submit review');
            }
        }

        // View submitted review
        function viewReview(reviewId) {
            const review = currentReviews.find(r => r.id === reviewId);
            if (!review) return;
            
            document.getElementById('viewCommentsToAuthor').textContent = review.comments_to_author || 'No comments';
            document.getElementById('viewCommentsToEditor').textContent = review.comments_to_editor || 'No comments';
            document.getElementById('viewRecommendation').textContent = review.recommendation || 'Not specified';
            document.getElementById('viewSubmittedDate').textContent = new Date(review.submitted_date).toLocaleString();
            
            document.getElementById('viewReviewModal').classList.remove('hidden');
        }

        // Close view review modal
        function closeViewReviewModal() {
            document.getElementById('viewReviewModal').classList.add('hidden');
        }

        // Remind reviewer (placeholder)
        function remindReviewer(reviewId) {
            alert('Reminder email functionality will be implemented in the future.');
        }

        // Setup search functionality
        function setupReviewSearch() {
            const searchInput = document.getElementById('reviewSearch');
            let searchTimeout;
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredReviews = currentReviews.filter(review => 
                        review.manuscript_title.toLowerCase().includes(searchTerm) ||
                        review.reviewer_name.toLowerCase().includes(searchTerm) ||
                        review.manuscript_id.toString().includes(searchTerm)
                    );
                    displayReviews(filteredReviews);
                }, 300);
            });
        }

        // ==================== EDITOR FUNCTIONS ====================
        
        // Load editors
        async function loadEditors(searchTerm = '') {
            try {
                const response = await fetch(`/api/editors?search=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                
                const editorsList = document.getElementById('editorsList');
                const noEditors = document.getElementById('noEditors');
                
                if (data.success && data.editors.length > 0) {
                    editorsList.innerHTML = data.editors.map(editor => `
                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-medium text-gray-900">Dr. ${editor.first_name} ${editor.last_name}</h4>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-semibold rounded-full">Available</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">${editor.email}</p>
                            ${editor.expertise ? `
                                <div class="flex flex-wrap gap-2 mb-3">
                                    ${editor.expertise.split(',').map(skill => 
                                        `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${skill.trim()}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                            <div class="flex gap-2">
                                <button onclick="assignEditor(${editor.id})" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                    Assign Editor
                                </button>
                                <button onclick="removeEditor(${editor.id}, '${editor.first_name} ${editor.last_name}')" class="bg-red-600 text-white py-2 px-3 rounded-lg hover:bg-red-700 transition-colors" title="Remove Editor">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                    noEditors.classList.add('hidden');
                } else {
                    editorsList.innerHTML = '';
                    noEditors.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error loading editors:', error);
                alert('Failed to load editors');
            }
        }

        // Assign editor
        async function assignEditor(editorId) {
            const manuscriptSelect = document.getElementById('editorManuscriptSelect');
            const selectedOption = manuscriptSelect.options[manuscriptSelect.selectedIndex];
            
            if (!selectedOption.value) {
                alert('Please select a manuscript first');
                return;
            }
            
            const manuscriptId = selectedOption.value;
            const manuscriptTitle = selectedOption.dataset.title;
            const authors = selectedOption.dataset.authors || '';
            const abstract = selectedOption.dataset.abstract || '';
            
            // Optional: Ask for notes
            const notes = prompt('Add any additional notes for the editor (optional):') || '';
            
            try {
                const response = await fetch('/api/editors/assign', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        editorId,
                        manuscriptId,
                        manuscriptTitle,
                        authors: authors,
                        abstract: abstract,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Editor assigned successfully! The editor will receive a professional email notification.');
                } else {
                    alert('Failed to assign editor: ' + data.message);
                }
            } catch (error) {
                console.error('Error assigning editor:', error);
                alert('Failed to assign editor');
            }
        }

        // Remove editor
        async function removeEditor(editorId, editorName) {
            if (!confirm(`Are you sure you want to remove ${editorName}?\n\nThis action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/editors/${editorId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Editor removed successfully!');
                    loadEditors(); // Refresh the list
                } else {
                    alert('Failed to remove editor: ' + data.message);
                }
            } catch (error) {
                console.error('Error removing editor:', error);
                alert('Failed to remove editor');
            }
        }

        // Search editors
        function setupEditorSearch() {
            const searchInput = document.getElementById('editorSearch');
            let searchTimeout;
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    loadEditors(e.target.value);
                }, 300);
            });
        }

        // Show add editor modal
        function showAddEditorModal() {
            document.getElementById('addEditorModal').classList.remove('hidden');
        }

        // Hide add editor modal
        function hideAddEditorModal() {
            document.getElementById('addEditorModal').classList.add('hidden');
            document.getElementById('addEditorForm').reset();
        }

        // Add editor function
        async function addEditor(editorData) {
            try {
                const response = await fetch('/api/editors/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(editorData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Editor added successfully!');
                    hideAddEditorModal();
                    loadEditors(); // Refresh the list
                } else {
                    alert('Failed to add editor: ' + data.message);
                }
            } catch (error) {
                console.error('Error adding editor:', error);
                alert('Failed to add editor');
            }
        }

        // Setup add editor form
        function setupAddEditorForm() {
            const form = document.getElementById('addEditorForm');
            if (form) {
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const editorData = {
                        firstName: document.getElementById('editorFirstName').value,
                        lastName: document.getElementById('editorLastName').value,
                        email: document.getElementById('editorEmail').value,
                        expertise: document.getElementById('editorExpertise').value,
                        password: 'temp_password_123' // Temporary password, editor can reset
                    };
                    
                    await addEditor(editorData);
                });
            }
        }

        // Initialize
        checkAdminAuth();
        initCharts();
        loadReviewers();
        setupReviewerSearch();
        loadReviews();
        setupReviewSearch();
        loadEditors();
        setupEditorSearch();
        
        // Setup forms after DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setupAddReviewerForm();
            setupAddEditorForm();
        });
        
        // Also setup immediately in case DOM is already loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setupAddReviewerForm();
                setupAddEditorForm();
            });
        } else {
            setupAddReviewerForm();
            setupAddEditorForm();
        }
    </script>
</body>
</html>
